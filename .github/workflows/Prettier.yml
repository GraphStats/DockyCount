name: Run Prettier

on:
  push:
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  format:
    name: Run Prettier
    runs-on: ubuntu-latest
    permissions: write-all

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: "23"

      - name: Install project dependencies
        run: npm i

      - name: Run Prettier to format files
        run: npx prettier . --write

      - name: Check for changes
        id: git_status
        run: |
          # The 'git status --porcelain' command will output nothing if there are no changes.
          # If there are changes, it will output a non-empty string.
          # We check the length of this string to determine if changes exist.
          if [ -n "$(git status --porcelain)" ]; then
            echo "has_changes=true" >> "$GITHUB_OUTPUT"
          else
            echo "has_changes=false" >> "$GITHUB_OUTPUT"
          fi

      - name: Create Git commit for formatting changes
        if: steps.git_status.outputs.has_changes == 'true'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "indentation"
          branch: ${{ github.head_ref || github.ref_name }}
